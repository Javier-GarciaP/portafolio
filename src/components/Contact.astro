---
import ContactCard from "./ContactCard.astro";
import SectionContainer from "./SectionContainer.astro";
---

<div class="flex justify-center min-w-full bg-gray-900 text-gray-50">
  <SectionContainer id="Contact">
    <h1 class="text-center text-2xl">
      Contáctame <span class="font-bold">Aquí</span>
    </h1>
    <form id="contact-form">
      <div class="flex flex-col mt-6 max-w-md mx-auto gap-4">
        <input
          type="text"
          name="name"
          required
          placeholder="Tu Nombre"
          class="p-3 rounded-md border-2 border-gray-700 bg-gray-800 text-gray-50 focus:outline-none focus:border-gray-500 transition-colors duration-200"
        />
        <input
          type="email"
          name="email"
          required
          placeholder="Tu Correo Electrónico"
          class="p-3 rounded-md border-2 border-gray-700 bg-gray-800 text-gray-50 focus:outline-none focus:border-gray-500 transition-colors duration-200"
        />
        <textarea
          name="message"
          required
          rows="5"
          placeholder="Tu Mensaje"
          class="p-3 rounded-md border-2 border-gray-700 bg-gray-800 text-gray-50 focus:outline-none focus:border-gray-500 transition-colors duration-200"
        ></textarea>
        <button
          type="submit"
          id="submit-button"
          class="bg-gray-700 hover:bg-gray-600 text-gray-50 font-bold py-2 px-4 rounded-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Enviar Mensaje
        </button>
        <div id="form-status" class="text-center hidden p-2 rounded-md"></div>
      </div>
    </form>
    <div class="flex justify-center">
      <ContactCard isLight={false} />
    </div>
  </SectionContainer>
</div>

<script>
  import { actions } from "astro:actions";

  const form = document.getElementById("contact-form") as HTMLFormElement;
  const statusDiv = document.getElementById("form-status");
  const submitButton = document.getElementById(
    "submit-button",
  ) as HTMLButtonElement;

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (!statusDiv || !submitButton) return;

    // Reset status
    statusDiv.classList.add("hidden");
    statusDiv.textContent = "";
    submitButton.disabled = true;
    submitButton.textContent = "Enviando...";

    const formData = new FormData(form);

    try {
      const { data, error } = await actions.sendEmail(formData);

      if (error) {
        statusDiv.textContent = `Error: ${error.message || "Ocurrió un error al enviar el mensaje"}`;
        statusDiv.classList.remove("hidden");
        statusDiv.classList.add("bg-red-900/50", "text-red-200");
      } else {
        statusDiv.textContent = "¡Mensaje enviado con éxito!";
        statusDiv.classList.remove("hidden");
        statusDiv.classList.add("bg-green-900/50", "text-green-200");
        form.reset();
      }
    } catch (e) {
      statusDiv.textContent = "Ocurrió un error inesperado.";
      statusDiv.classList.remove("hidden");
      statusDiv.classList.add("bg-red-900/50", "text-red-200");
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = "Enviar Mensaje";
    }
  });
</script>
